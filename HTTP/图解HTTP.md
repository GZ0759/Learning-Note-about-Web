> 图解HTTP
> 著：［日］上野宣
> 2014年5月第一次印刷

# 第一章 了解Web及网络基础

## 1.1 使用HTTP协议访问Web

Web 页面不能凭空显示出来。根据 Web 浏览器地址栏中指定的 URL， Web 浏览器从 Web 服务器端获取文件资源（resource）等信息，从而显示出 Web 页面。像这种通过发送请求获取服务器资源的 Web 浏览器等，都可称为客户端（client）。

Web 使用一种名为 HTTP（HyperText Transfer Protocol，超文本传输协议）的协议作为规范，完成从客户端到服务器端等一系列运作流程。而协议是指规则的约定。可以说， Web 是建立在 HTTP 协议上通信的。

## 1.2 HTTP的诞生

现在已提出了 3 项 WWW 构建技术，分别是：把 SGML 作为页面的文本标记语言的 HTML（HyperText Markup Language，超文本标记语言）；作为文档传递协议的 HTTP ；指定文档所在地址的 URL（Uniform Resource Locator，统一资源定位符）。

WWW 这一名称， 是 Web 浏览器当年用来浏览超文本的客户端应用程序时的名称。现在则用来表示这一系列的集合，也可简称为 Web。

## 1.3 网络基础TCP/IP

通常使用的网络（包括互联网）是在 TCP/IP 协议族的基础上运作的。而 HTTP 属于它内部的一个子集。

不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为协议（protocol）。协议中存在各式各样的内容。从电缆的规格到 IP 地址的选定方法、寻找异地用户的方法、双方建立通信的顺序，以及 Web 页面显示需要处理的步骤，等等。

像这样把与互联网相关联的协议集合起来总称为 TCP/IP。也有说法认为， TCP/IP 是指 TCP 和 IP 这两种协议。还有一种说法认为， TCP/IP 是在 IP 协议的通信过程中，使用到的协议族的统称。

TCP/IP 协议族里重要的一点就是分层。 TCP/IP 协议族按层次分别分为以下 4 层： 应用层、传输层、网络层和数据链路层。

- 应用层。应用层决定了向用户提供应用服务时通信的活动。
- 传输层。传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。
- 网络层（又名网络互联层）。网络层用来处理在网络上流动的数据包。
- 链路层（又名数据链路层，网络接口层）。用来处理连接网络的硬件部分。

利用 TCP/IP 协议族进行网络通信时，会通过分层顺序与对方进行通信。发送端从应用层往下走，接收端则往应用层往上走。

发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。 反之，接收端在层与层传输数据时，每经过一层时会把对应的首部消去。这种把数据信息包装起来的做法称为封装（encapsulate）。

## 1.4 与HTTP关系密切的协议：IP、TCP和DNS

负责传输的 IP 协议。按层次分， IP（Internet Protocol）网际协议位于网络层。

IP 协议的作用是把各种数据包传送给对方。 而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址（Media Access Control Address）。IP 地址指明了节点被分配到的地址， MAC 地址是指网卡所属的固定地址。 IP 地址可以和 MAC 地址进行配对。 IP 地址可变换，但 MAC 地址基本上不会更改。

使用 ARP 协议凭借 MAC 地址进行通信。IP 间的通信依赖 MAC 地址。在网络上，通信的双方在同一局域网（LAN）内的情况是很少的，通常是经过多台计算机和网络设备中转才能连接到对方。 而在进行中转时，会利用下一站中转设备的 MAC 地址来搜索下一个中转目标。 这时，会采用 ARP 协议（Address Resolution Protocol）。 ARP 是一种用以解析地址的协议，根据通信方的 IP 地址就可以反查出对应的 MAC 地址。

确保可靠性的 TCP 协议。按层次分， TCP 位于传输层，提供可靠的字节流服务。

所谓的字节流服务（Byte Stream Service）是指，为了方便传输，将大块数据分割成以报文段（segment）为单位的数据包进行管理。而可靠的传输服务是指， 能够把数据准确可靠地传给对方。一言以蔽之，TCP 协议为了更容易传送大数据才把数据分割， 而且 TCP 协议能够确认数据最终是否送达到对方。

确保数据能到达目标。为了准确无误地将数据送达目标处， TCP 协议采用了三次握手（three-way handshaking）策略。用 TCP 协议把数据包送出去后， TCP 不会对传送后的情况置之不理， 它一定会向对方确认是否成功送达。握手过程中使用了 TCP 的标志（flag）——SYN（synchronize）和 ACK （acknowledgement）。

## 1.5 负责域名解析的DNS服务

DNS（Domain Name System）服务是和 HTTP 协议一样位于应用层的协议。它提供域名到 IP 地址之间的解析服务。

计算机既可以被赋予 IP 地址，也可以被赋予主机名和域名。比如www.hackr.jp。用户通常使用主机名或域名来访问对方的计算机， 而不是直接通过IP 地址访问。 因为与 IP 地址的一组纯数字相比，用字母配合数字的表示形式来指定计算机名更符合人类的记忆习惯。

但要让计算机去理解名称， 相对而言就变得困难了。因为计算机更擅长处理一长串数字。为了解决上述的问题， DNS 服务应运而生。 DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址。

## 1.6 各种协议与HTTP协议的关系

客户端。

HTTP协议的职责。生成针对目标Web服务器的HTTP请求报文。

TCP协议的职责。为了方便通信，将HTTP请求报文分割成报文段。

路由器。

IP协议的职责。搜索对方的地址，一边中转一边传送。

服务器。

TCP协议的职责。从对方那里接收到的报文段

HTTP协议的职责。对Web服务器请求的内容的处理

# 1.7 URI和URL

统一资源标识符。URI 是 Uniform Resource Identifier 的缩写。 URI 就是由某个协议方案表示的资源的定位标识符。协议方案是指访问资源所使用的协议类型名称。采用HTTP协议时，协议方案就是http。除此之外，还有ftp、mailto、telnet、file等。

- Uniform。规定统一的格式可方便处理多种不同类型的资源，而不用根据上下文环境来识别资源指定的访问方式。 另外，加入新增的协议方案（如 http: 或 ftp:）也更容易。

- Resource。资源的定义是“可标识的任何东西”。除了文档文件、图像或服务（例如当天的天气预报）等能够区别于其他类型的， 全都可作为资源。另外，资源不仅可以是单一的，也可以是多数的集合体。

- Identifier。表示可标识的对象。也称为标识符。

URI格式。表示指定的 URI，要使用涵盖全部必要信息的绝对 URI、绝对 URL 以及相对 URL。相对 URL，是指从浏览器中基本 URI 处指定的 URL，形如 /image/logo.gif。

使用 http: 或 https: 等协议方案名获取访问资源时要指定协议类型。不区分字母大小写，最后附一个冒号（:）。也可使用 data: 或 javascript: 这类指定数据或脚本程序的方案名。

# 第二章 简单的HTTP协议

## 2.1 HTTP协议用于客户端和服务器端之间的通信 

HTTP 协议和 TCP/IP 协议族内的其他众多的协议相同，用于客户端和服务器之间的通信。请求访问文本或图像等资源的一端称为客户端， 而提供资源响应的一端称为服务器端。在两台计算机之间使用 HTTP 协议通信时，在一条通信线路上必定有一端是客户端，另一端则是服务器端。

## 2.2 通过请求和响应的交换达成通信

HTTP 协议规定，请求从客户端发出，最后服务器端响应该请求并返回。换句话说，肯定是先从客户端开始建立通信的，服务器端在没有接收到请求之前不会发送响应。

客户端发送给服务器端的请求报文内容如下。起始行开头的 GET 表示访问服务器的类型，称为方法
（method）。随后的字符串 /index.htm 指明了请求访问的资源对象，也叫做请求 URI（request-URI）。最后的 HTTP/1.1，即 HTTP 的版本号，用来提示客户端使用的 HTTP 协议功能。综合来看，这段请求内容的意思是：请求访问某台 HTTP 服务器上的 /index.htm 页面资源。

```
GET /index.htm HTTP/1.1
Host: hackr.jp
```

请求报文是由请求方法、 请求 URI、协议版本、可选的请求首部字段和内容实体构成的。

```
POST /form/entry HTTP/1.1

Host: hackr.jp
Connection: keep-alive
Content-Type: application/x-www-form-urlencoded
Content-Length: 16

name=ueno&age=37
```

## 2.3 HTTP是不保存状态的协议

## 2.4 请求URI定位资源

## 2.5 告知服务器意图的HTTP方法

## 2.6 使用方法下达命令

## 2.7 持久连接节省通信量

## 2.8 使用Cookie的状态管理

# 第三章 HTTP报文内的HTTP信息

# 第四章 返回结果的HTTP状态码

# 第五章 与HTTP协作的Web服务器

# 第六章 HTTP首部

# 第七章 确保Web安全的HTTPS

# 第八章 确认访问用户身份的认证

# 第九章 基于HTTP的功能追加协议

# 第十章 构建Web内容的技术

# 第十一章 Web的攻击技术

