> Vue.js 组件精讲
> Aresn iView 的作者 《Vue.js实战》的作者

# 1 开篇：Vue.js 的精髓——组件

## 组件的分类

一般来说，Vue.js 组件主要分成三类：

1. 由 `vue-router` 产生的每个页面，它本质上也是一个组件（.vue），主要承载当前页面的 HTML 结构，会包含数据获取、数据整理、数据可视化等常规业务。整个文件相对较大，但一般不会有 `props` 选项和 `自定义事件`，因为它作为路由的渲染，不会被复用，因此也不会对外提供接口。

2. 不包含业务，独立、具体功能的基础组件，比如日期选择器、模态框等。这类组件作为项目的基础控件，会被大量使用，因此组件的 API 进行过高强度的抽象，可以通过不同配置实现不同的功能。比如笔者开源的 iView，就是包含了 50 多个这样基础组件的 UI 组件库。

3. 业务组件。它不像第二类独立组件只包含某个功能，而是在业务中被多个页面复用的，它与独立组件的区别是，业务组件只在当前项目中会用到，不具有通用性，而且会包含一些业务，比如数据请求；而独立组件不含业务，在任何项目中都可以使用，功能单一，比如一个具有数据校验功能的输入框。

## 小册的内容

因为本小册是围绕 Vue.js 组件展开的，所以第二节会讲解 Vue.js 组件的三个 API：`prop`、`event`、`slot`。

- 3 - 7 小节会介绍组件间通信的一些方法和黑科技，一部分是 Vue.js 内置的，一部分是自行实现的，在实际开发中，会非常实用。例如具有数据校验功能的表单组件（Form）和组合多选框组件（CheckboxGroup & Checkbox）。

- 8 - 10 小节介绍 Vue 的构造器 extend 和手动挂载组件 $mount 的用法及案例。Vue.js 除了我们正常 `new Vue()` 外，还可以手动挂载的，例如动态渲染 .vue 文件的组件（Display）和全局通知组件（$Alert）。

- 11 - 12 小节介绍 Render 函数与 Functional Render，并完成一个能够渲染自定义列的 Table 组件。Render 函数也是 Vue.js 组件重要的一部分，只不过在大多数业务中不常使用。本小节会介绍它的使用场景。

- 13 小节介绍作用域 slot（slot-scope），并基于这种方法同样实现 Table 组件。slot 用的很多，但 slot-scope  在业务中并不常用，但在一些特定场景下，比如组件内部有循环体时，会非常实用。

- 14 - 15 小节介绍递归组件，并完成树形控件（Tree）。

- 16 - 19 小节是综合拓展，会着重讲解 Vue.js 容易忽略却很重要的 API，以及对 Vue.js 面试题的详细分析。除此之外，还会总结笔者在两年的 iView 开源经历中的经验，除了技术细节外，还包括开源项目的持续性发展、推广等。

# 2 基础：Vue.js 组件的三个 API：prop、event、slot

## 组件的构成

一个再复杂的组件，都是由三部分组成的：prop、event、slot，它们构成了 Vue.js 组件的 API。如果开发的是一个通用组件，那一定要事先设计好这三部分，因为组件一旦发布，后面再修改 API 就很困难了，使用者都是希望不断新增功能，修复 bug，而不是经常变更接口。

属性 prop 。`prop` 定义了这个组件有哪些可配置的属性，组件的核心功能也都是它来确定的。写通用组件时，props 最好用**对象**的写法，这样可以针对每个属性设置类型、默认值或自定义校验属性的值，这点在组件开发中很重要。

插槽 slot 。如果要给按钮组件 `<i-button>` 添加一些文字内容，就要用到组件的第二个 API：插槽 slot，它可以分发组件的内容。

自定义事件 event。现在我们给组件 `<i-button>` 加一个点击事件，目前有两种写法，先看自定义事件 event。通过 `$emit`，就可以触发自定义的事件 `on-click` ，在父级通过 `@on-click` 来监听。这里还有另一种方法，直接在父级声明，但为了区分原生事件和自定义事件，要用到事件修饰符 `.native`。

```html
<i-button @click.native="handleClick"></i-button>
```

这两种方法的弊端是，无法在**跨级**或**兄弟**间通信。那这种情况下，就得配置额外的插件或工具了，比如 Vuex 和 Bus 的解决方案，本小册不再做它们的介绍，读者可以自行阅读相关内容。不过，它们都是依赖第三方插件的存在，这在开发独立组件时是不可取的，而在小册的后续章节，会陆续介绍一些黑科技，它们完全不依赖任何三方插件，就可以轻松得到任意的组件实例，或在任意组件间进行通信，且适用于任意场景。

## 组件的通信

一般来说，组件可以有以下几种关系：

A 和 B、B 和 C、B 和 D 都是父子关系，C 和 D 是兄弟关系，A 和 C 是隔代关系（可能隔多代）。组件间经常会通信，Vue.js 内置的通信手段一般有两种：

- `ref`：给元素或组件注册引用信息；
- `$parent` / `$children`：访问父 / 子实例。

这两种都是直接得到组件实例，使用后可以直接调用组件的方法或访问数据，比如下面的示例中，用 ref 来访问组件（部分代码省略）：

# 3 组件的通信 1：provide / inject
# 4 组件的通信 2：派发与广播——自行实现 dispatch 和 broadcast 方法
# 5 实战 1：具有数据校验功能的表单组件——Form
# 6 组件的通信 3：找到任意组件实例——findComponents 系列方法
# 7 实战 2：组合多选框组件——CheckboxGroup & Checkbox
# 8 Vue 的构造器——extend 与手动挂载——$mount
# 9 实战 3：动态渲染 .vue 文件的组件—— Display
# 10 实战 4：全局提示组件——$Alert
# 11 更灵活的组件：Render 函数与 Functional Render
# 12 实战 5：可用 Render 自定义列的表格组件——Table
# 13 实战 6：可用 slot-scope 自定义列的表格组件——Table
# 14 递归组件与动态组件
# 15 实战 7：树形控件——Tree
# 16 拓展：Vue.js 容易忽略的 API 详解
# 17 拓展：Vue.js 面试、常见问题答疑
# 18 拓展：如何做好一个开源项目（上篇）
# 19 拓展：如何做好一个开源项目（下篇）
# 20 写在最后